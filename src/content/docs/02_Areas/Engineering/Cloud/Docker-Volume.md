---
title: Docker Volume
desc: What is docker Volume
---

A Docker volume is a mechanism for persisting data generated by and used by Docker containers, ensuring data is not lost when containers are stopped, removed, or rebuilt. Volumes are the recommended way to manage data in Docker and are entirely managed by the Docker engine, isolated from the host machine's core filesystem.

By default, data written inside a container's writable layer is temporary and lost when the container is removed. Docker volumes solve this by: 

- **Data Persistence**: Ensuring important data (like databases, configuration files, or logs) remains intact across container lifecycles.
- **Data Sharing**: Allowing multiple containers to safely share and access the same data simultaneously.
- **Performance**: Offering better I/O performance compared to writing data directly to the container's writable layer.
- **Backup and Migration**: Simplifying the process of backing up, restoring, and migrating data.
- **Portability**: Working consistently across different operating systems (Linux, Windows, etc.) and environments, making data migration easier. 

## 1ï¸âƒ£ Why Docker Volumes Exist (Problem First)

### âŒ Without volumes

Containers are **ephemeral**.

```bash
docker run ubuntu touch /data.txt
docker stop <container>
docker rm <container>
```

ğŸ‘‰ `data.txt` is **gone forever**.

This is bad for:

* Databases
* Logs
* Models (Ollama!)
* App uploads
* Caches

---

## 2ï¸âƒ£ What a Docker Volume Is (Simple Definition)

> A **Docker volume** is a **persistent storage location managed by Docker**, stored **outside the container filesystem**, and **survives container restarts & deletion**.

```
Container (stateless)
   â”‚
   â”œâ”€â”€ /app
   â”œâ”€â”€ /tmp
   â””â”€â”€ /data  â† mounted volume (persistent)
```

---

## 3ï¸âƒ£ Types of Docker Storage (IMPORTANT)

| Type           | Managed by Docker | Persistent | Use case                     |
| -------------- | ----------------- | ---------- | ---------------------------- |
| **Volume**     | âœ…                 | âœ…          | Databases, models, prod data |
| **Bind mount** | âŒ                 | âœ…          | Dev, source code             |
| **tmpfs**      | Docker            | âŒ          | Secrets, memory-only         |

Weâ€™ll focus on **volumes** (best practice).

---

## 4ï¸âƒ£ Docker Volume vs Bind Mount (Very Important)

### ğŸ”¹ Docker Volume

```bash
-v mydata:/data
```

* Stored in `/var/lib/docker/volumes/`
* Docker manages permissions
* Safer
* Best for production

---

### ğŸ”¹ Bind Mount

```bash
-v ~/project:/app
```

* Uses host filesystem directly
* Faster iteration
* Dangerous in production
* Permission issues common

---

## 5ï¸âƒ£ Create & Inspect Volumes

### Create a volume

```bash
docker volume create myvolume
```

### List volumes

```bash
docker volume ls
```

### Inspect volume

```bash
docker volume inspect myvolume
```

Output shows:

* Mountpoint
* Driver
* Usage

---

## 6ï¸âƒ£ Use a Volume in a Container

### Example: Persistent data

```bash
docker run -it \
  -v myvolume:/data:ro \
  ubuntu \
  bash
```

Inside container:

```bash
echo "hello" > /data/test.txt
exit
```

Delete container:

```bash
docker rm <container>
```

Run again:

```bash
docker run -it -v myvolume:/data ubuntu bash
cat /data/test.txt
```

âœ… File still exists

---

## 7ï¸âƒ£ Named Volume vs Anonymous Volume

### âŒ Anonymous (DONâ€™T USE)

```bash
docker run -v /data ubuntu
```

* Docker auto-creates random volume
* Hard to manage
* Easy to leak disk space

---

### âœ… Named (BEST PRACTICE)

```bash
docker run -v app-data:/data ubuntu
```

âœ” Easy to manage
âœ” Reusable
âœ” Clear ownership

---

## 8ï¸âƒ£ Real Example: PostgreSQL (Classic Use Case)

```bash
docker run -d \
  --name postgres \
  -e POSTGRES_PASSWORD=secret \
  -v pgdata:/var/lib/postgresql/data \
  postgres
```

Delete container:

```bash
docker rm -f postgres
```

Run again with same volume:

```bash
docker run -d \
  --name postgres \
  -e POSTGRES_PASSWORD=secret \
  -v pgdata:/var/lib/postgresql/data \
  postgres
```

âœ… Database still exists

---

## 9ï¸âƒ£ Real Example: Ollama (VERY relevant to you)

```bash
docker run -d \
  --name ollama \
  -p 11434:11434 \
  -v ollama-data:/root/.ollama \
  ollama/ollama
```

Whatâ€™s stored?

* Models (GBs)
* Cache
* Config

Delete container â†’ **models stay**

---

## ğŸ”Ÿ Where Docker Volumes Live (Linux)

```bash
/var/lib/docker/volumes/
```

Example:

```
/var/lib/docker/volumes/ollama-data/_data/
```

âš ï¸ Do NOT edit manually unless you know what youâ€™re doing.

---

## 1ï¸âƒ£1ï¸âƒ£ Backup & Restore Volumes (IMPORTANT)

### Backup

```bash
docker run --rm \
  -v myvolume:/data \
  -v $(pwd):/backup \
  ubuntu \
  tar czf /backup/myvolume.tar.gz /data
```

---

### Restore

```bash
docker run --rm \
  -v myvolume:/data \
  -v $(pwd):/backup \
  ubuntu \
  tar xzf /backup/myvolume.tar.gz -C /
```

---

## 1ï¸âƒ£2ï¸âƒ£ Delete Volumes (Danger Zone)

### Remove unused volumes

```bash
docker volume prune
```

âš ï¸ This deletes **ALL unused volumes**.

---

### Remove specific volume

```bash
docker volume rm myvolume
```

âŒ Data permanently lost.

---

## 1ï¸âƒ£3ï¸âƒ£ Volumes in docker-compose (Most Common)

```yaml
version: "3.9"
services:
  app:
    image: node:20
    volumes:
      - app-data:/app/data

volumes:
  app-data:
```

Run:

```bash
docker compose up -d
```

---

## 1ï¸âƒ£4ï¸âƒ£ Permissions & Ownership (Common Pain)

### Problem

* Container runs as root
* Host user â‰  container user
* Files become unreadable

### Solution patterns

* Use named volumes (Docker handles perms)
* Avoid bind mounts for prod
* Match UID/GID when needed

---

## 1ï¸âƒ£5ï¸âƒ£ Best Practices (READ THIS)

âœ… Use **named volumes**
âœ… One volume per responsibility
âœ… Never rely on container FS
âœ… Backup volumes
âœ… Avoid anonymous volumes
âŒ Donâ€™t use volumes for secrets
âŒ Donâ€™t edit volume files manually

---

## ğŸ§  Mental Model (Remember Forever)

```
Image = code
Container = running process
Volume = data
```

Delete image â†’ OK
Delete container â†’ OK
Delete volume â†’ ğŸ’€ DATA GONE

---

## ğŸ Summary

| Task            | Use           |
| --------------- | ------------- |
| Persist data    | Docker volume |
| Dev source code | Bind mount    |
| Databases       | Volume        |
| ML models       | Volume        |
| Secrets         | env / tmpfs   |

---

